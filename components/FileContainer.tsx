import RouteOutlinedIcon from "@mui/icons-material/RouteOutlined";
import FolderCopyOutlinedIcon from "@mui/icons-material/FolderCopyOutlined";
import SaveOutlinedIcon from "@mui/icons-material/SaveOutlined";
import { useRouter } from "next/router";
import formatBytes from "@/utilities/formatBytes";
import Files from "./Files";
import Link from "next/link";
import Head from "next/head";
import { useEffect, useState } from "react";

export default function FileContainer({ files, folders, path }: filePropType) {
  const router = useRouter();

  const [search, setSearch] = useState<string>();
  const [copied, setCopied] = useState(false);

  const copyCode = async () => {
    try {
      await navigator.clipboard.writeText(
        process.env.NEXT_PUBLIC_PASSWORD || ""
      );
      setCopied(true);
    } catch (e) {}
  };

  useEffect(() => {
    if (copied)
      setTimeout(() => {
        setCopied(false);
      }, 1500);
  }, [copied]);

  return (
    <div className="flex flex-col gap-4 items-center m-2">
      <Head>
        <title>
          {router.asPath.replaceAll("%20", " ")} - MalwarePad&apos;s files
        </title>
        <link rel="icon" type="image/x-icon" href="/favicon.png" />
        <meta
          name="title"
          content={`${path?.replaceAll("%20", " ")} - MalwarePad's files`}
        />
        <meta
          name="description"
          content="An archive of useful software, operating systems and much more."
        />
        <meta name="keywords" content="malwareapd, files, malwarepad files" />
        <meta name="robots" content="index, follow" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="language" content="English" />
      </Head>
      <div className="flex flex-col items-center text-center gap-1">
        <div className="text-2xl font-semibold">MalwarePad&apos;s files</div>
        <div className="flex flex-row max-sm:flex-col items-center gap-1.5">
          <div className="flex flex-row gap-1">
            <RouteOutlinedIcon /> {router.asPath.replaceAll("%20", " ")}
          </div>
          <div className="flex flex-row gap-1">
            <FolderCopyOutlinedIcon />
            {formatBytes(
              (files.length > 0
                ? files.map((o) => o.Size).reduce((a, b) => a + b)
                : 0) +
                (folders.length > 0
                  ? folders.map((o) => o.Size).reduce((a, b) => a + b)
                  : 0)
            )}
          </div>
          <div className="flex flex-row gap-1">
            <SaveOutlinedIcon />
            {files.length + folders.length} items
          </div>
        </div>
      </div>
      <div className="flex flex-col gap-2 p-1 rounded-lg">
        <div className="m-1 -mb-3">
          <input
            value={search}
            onChange={(e) => setSearch(e.target.value)}
            title="Search"
            placeholder="Search"
            className="w-full border-none outline-none focus:outline-black dark:focus:outline-white outline-1 outline-offset-0 transition-all text-black dark:text-white bg-neutral-200 dark:bg-neutral-700 px-2 py-1 rounded-lg"
          />
        </div>
        <Files
          files={files}
          router={router}
          folders={folders}
          search={search}
        />
      </div>
      <div className="text-center">
        <div className="relative">
          {process.env.NEXT_PUBLIC_PASSWORD && (
            <div>
              The password to the archives is always{" "}
              <button
                onClick={copyCode}
                className="underline underline-offset-1 font-medium"
              >
                {process.env.NEXT_PUBLIC_PASSWORD}
              </button>
            </div>
          )}
          <div
            className={`absolute right-0 bg-neutral-200/50 dark:bg-neutral-700/50 px-2 rounded-lg transition-all ${
              copied ? "opacity-100 -top-6" : "opacity-0 invisible top-0"
            }`}
          >
            Copied successfully!
          </div>
        </div>
        <div>Please use any software here for personal use only.</div>
      </div>
      <div className="text-center">
        <div>
          If there is anything broken, feel free to contact me over at{" "}
          <Link
            className="font-medium underline underline-offset-1"
            href="mailto:contact@malwarepad.com"
          >
            contact@malwarepad.com
          </Link>
          .
        </div>
        <div>
          &copy; Copyright{" "}
          <Link
            href="https://malwarepad.com/"
            target="_blank"
            passHref
            className="text-neutral-600 hover:text-neutral-500 dark:text-neutral-300 dark:hover:text-neutral-400 transition-all"
          >
            MalwarePad Productions
          </Link>{" "}
          2016 - {new Date().getFullYear()}
        </div>
        <div className="flex flex-row gap-1 items-center justify-center text-xl">
          <Link
            className="dark:invert hover:scale-125 transition-all w-6"
            href="https://nextjs.org/"
            target="_blank"
            passHref
          >
            <svg viewBox="0 0 128 128" fill="black">
              <path d="M64 0C28.7 0 0 28.7 0 64s28.7 64 64 64 64-28.7 64-64S99.3 0 64 0zm32.7 114.4L48.4 41.8h-6.8v50.1h6.8V55.3l44.2 61.5c-8.5 4.6-18.2 7.2-28.6 7.2-33.2.1-60.1-26.8-60.1-60S30.8 3.9 64 3.9s60.1 26.9 60.1 60.1c0 21.1-10.9 39.7-27.4 50.4z"></path>
              <path d="M78.6 73.3l7.5 11.3V41.8h-7.5z"></path>
            </svg>
          </Link>
          <div>+</div>
          <Link
            className="dark:invert hover:scale-125 transition-all w-6"
            href="https://redis.io/"
            target="_blank"
            passHref
          >
            <svg viewBox="0 0 128 128">
              <path
                d="M6.2 52.7c6.7 3.2 43.7 18.1 49.5 20.9 5.8 2.8 10 2.8 17.4-1 7.4-3.9 42.2-18.1 48.9-21.6 3.4-1.8 4.9-3.2 4.9-4.4V34.1c0-1.3-1.7-2.4-5-3.6-6.5-2.4-41.1-16.1-47.7-18.6-6.6-2.4-9.3-2.3-17.1.5C49.3 15.2 12.6 29.6 6 32.2c-3.2 1.3-5 2.4-5 3.7H.8v12.7c.2 1.2 2.1 2.5 5.4 4.1zm60.4 1.8l-20.3-8.4 29.1-4.5-8.8 12.9zm44.1-20l-17.2 6.8-1.9.7-17.2-6.8 19.1-7.5 17.2 6.8zM60.1 22l-2.8-5.2 8.8 3.4 8.3-2.7-2.2 5.4 8.4 3.2-10.9 1.1-2.4 5.9-3.9-6.5-12.6-1.1 9.3-3.5zm-21.7 7.3c8.6 0 15.6 2.7 15.6 6s-7 6-15.6 6-15.6-2.7-15.6-6 7-6 15.6-6zM122 59.8c-6.7 3.5-41.4 17.8-48.8 21.6-7.4 3.9-11.5 3.8-17.3 1-5.8-2.8-43-17.7-49.6-20.9C2.9 59.9 1 58.6 1 57.3V70c0 1.3 1.9 2.6 5.2 4.2 6.7 3.2 43.7 18.1 49.5 20.9 5.8 2.8 10 2.8 17.4-1 7.4-3.9 42.2-18.1 48.9-21.6 3.4-1.8 4.9-3.2 4.9-4.4V55.6c0 1.1-1.6 2.5-4.9 4.2zm0 20.7c-6.7 3.5-41.4 17.8-48.8 21.6-7.4 3.9-11.5 3.8-17.3 1-5.8-2.8-43-17.7-49.6-20.9C2.9 80.7 1 79.3 1 78v12.7c0 1.3 1.9 2.6 5.2 4.2 6.7 3.2 43.7 18.1 49.5 20.9 5.8 2.8 10 2.8 17.4-1 7.4-3.9 42.2-18.1 48.9-21.6 3.4-1.8 4.9-3.2 4.9-4.4V76.3c0 1.2-1.6 2.5-4.9 4.2z"
                fill="black"
              ></path>
            </svg>
          </Link>
          <div>=</div>
          <div className="dark:invert w-6">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
              <path
                fill="black"
                fill-rule="evenodd"
                d="M3.172 5.172a4 4 0 0 1 5.656 0L10 6.343l1.172-1.171a4 4 0 1 1 5.656 5.656L10 17.657l-6.828-6.829a4 4 0 0 1 0-5.656Z"
                clip-rule="evenodd"
              />
            </svg>
          </div>
        </div>
      </div>
    </div>
  );
}
